<view class="page" style="--page-nav-height: {{navBarHeight}}px;">
  <view class="status" />

  <home-header
    avatar-url="{{avatarUrl}}"
    avatar-text="{{avatarText}}"
    greet-name="{{greetName}}"
    greet-suffix="{{greetSuffix}}"
    greet-text="{{greetText}}"
    bind:profile="onOpenProfile"
    bind:menu="toggleChildMenu"
  />

  <view wx:if="{{menuOpen}}" class="menu-layer">
    <view class="menu-mask" bindtap="closeChildMenu" />
    <view class="menu-pop" style="top: {{menuPopoverTopPx}}px;">
      <view class="menu-pop__title">切换孩子</view>
      <view class="menu-pop__list">
        <button
          wx:for="{{children}}"
          wx:key="id"
          class="menu-item {{selectedChildId == item.id ? 'on' : ''}}"
          bindtap="onPickChild"
          data-id="{{item.id}}"
        >
          <view class="menu-item__row row between">
            <view class="menu-item__name">{{item.nickname}}</view>
            <view wx:if="{{selectedChildId == item.id}}" class="menu-item__dot" />
          </view>
        </button>
        <button class="menu-item add" bindtap="onAddChild">＋ 添加新孩子</button>
      </view>
    </view>
  </view>

  <scroll-view class="body safe-bottom" scroll-y="true" enhanced="true" show-scrollbar="false">
    <view wx:if="{{children.length == 0}}" class="empty col center">
      <view class="empty__logo">
        <view class="logo-dot">
          <view class="logo-smile" />
          <view class="logo-tail" />
        </view>
      </view>
      <view class="empty__title">还没有添加孩子</view>
      <view class="empty__desc">添加孩子信息后\n即可开启每日觉察记录</view>
      <button class="btn-primary" bindtap="onAddChild">添加孩子</button>
    </view>

    <view wx:else class="wrap">
      <view wx:if="{{banners.length}}" class="banner-wrap">
        <swiper
          class="banner"
          autoplay="true"
          circular="true"
          interval="3500"
          duration="400"
          indicator-dots="{{false}}"
          bindchange="onBannerChange"
        >
          <swiper-item wx:for="{{banners}}" wx:key="id">
            <view class="banner__item" bindtap="onBannerTap" data-id="{{item.id}}">
              <image class="banner__img" src="{{item.imageUrl}}" mode="aspectFill" />
              <!-- <view class="banner__mask" /> -->
              
            </view>
          </swiper-item>
        </swiper>

        <view wx:if="{{banners.length > 1}}" class="banner-indicators row">
          <view
            wx:for="{{banners}}"
            wx:key="id"
            class="dot {{bannerIndex == index ? 'on' : ''}}"
          />
        </view>
      </view>

      <view class="month row between">
        <view class="month__title">每日觉察</view>
        <picker mode="date" fields="month" value="{{monthValue}}" start="{{minMonthStart}}" end="{{maxMonthEnd}}" bindchange="onMonthChange">
          <view class="month__picker row a">
            <view class="month__picker-text">{{monthText}}</view>
            <image class="month__picker-icon" src="../../assets/image/uni-down.png" mode="aspectFit" />
          </view>
        </picker>
      </view>

      <view class="grid">
        <view
          wx:for="{{dayList}}"
          wx:key="id"
          class="obs"
          bindtap="onOpenDay"
          data-date="{{item.date}}"
        >
          <view class="thumb-wrap">
            <view class="thumb {{item.isDone ? '' : 'thumb-notdone'}}">
              <view class="thumb__inner">
                <view class="thumb__date">{{item.dayText}} / {{item.weekday}}</view>
                <view class="thumb__camera">
                  <view class="camera-icon">
                    <view class="camera-icon__body" />
                    <view class="camera-icon__top" />
                    <view class="camera-icon__lens" />
                    <view class="camera-icon__dot" />
                  </view>
                </view>

                <image wx:if="{{item.isDone && item.imageUrl}}" class="thumb__img" src="{{item.imageUrl}}" mode="aspectFill" />
                <image wx:elif="{{item.isDone}}" class="thumb__img thumb__img--fallback" src="../../assets/image/bgsw@x.png" mode="aspectFill" />

                <view wx:if="{{!item.isDone}}" class="plus">＋</view>
              </view>

              <view class="mood {{item.hasMood ? item.moodCls : 'mood-empty'}} {{item.hasMood && item.moodImageUrl ? 'mood--image' : ''}}">
                <image wx:if="{{item.hasMood && item.moodImageUrl}}" class="mood__img" src="{{item.moodImageUrl}}" mode="aspectFill" lazy-load="{{true}}" />
                <view wx:elif="{{item.hasMood}}" class="mood__emoji">{{item.moodEmoji}}</view>
                <view wx:else class="mood__blank" />
              </view>
            </view>
          </view>

          <view class="foot">
            <view class="foot__t text-ellipsis {{item.titleOn ? 'on' : ''}}">{{item.title}}</view>
            <view class="foot__s text-ellipsis {{item.contentOn ? 'on' : ''}}">{{item.content}}</view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
</view>
