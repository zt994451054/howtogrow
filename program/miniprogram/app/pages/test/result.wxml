<view class="page">
  <view class="status" style="height: {{statusBarHeight}}px;" />

  <view class="top row between">
    <view wx:if="{{mode == 'history'}}" class="back" bindtap="onBack">
      <ui-icon name="back" size="{{24}}" />
    </view>
    <view wx:else class="spacer" />
    <view class="top__title" wx:if="{{mode == 'history'}}">测试详情</view>
    <view class="close" bindtap="onDone">
      <ui-icon name="close" size="{{24}}" />
    </view>
  </view>

  <scroll-view class="body" scroll-y="true" enhanced="true" show-scrollbar="false">
    <view class="flag-wrap">
      <view class="flag">
        <view class="flag__bar" />
        <view class="flag__tag">今日\n建议</view>
      </view>
    </view>

    <view class="review">
      <view wx:for="{{reviewItems}}" wx:key="questionId" class="block">
        <view class="q row">
          <view class="q__no">{{index + 1}}</view>
          <view class="q__title">{{item.question}}</view>
        </view>

        <view class="your">
          <view class="your__label">你的选择</view>
          <view class="your__text">{{item.selectedText}}</view>
        </view>

        <view class="opts">
          <view class="opts__label">你的答案与建议</view>
          <view wx:for="{{item.selectedOptions}}" wx:for-item="opt" wx:key="optionId" class="opt is-selected {{opt.suggestFlag == 1 ? 'is-ok' : 'is-warn'}}">
            <view class="opt__head row">
              <view class="opt__icon">{{opt.suggestFlag == 1 ? '✓' : '!'}}</view>
              <view class="opt__content">{{opt.content}}</view>
            </view>
            <view wx:if="{{opt.improvementTip}}" class="opt__tip">{{opt.improvementTip}}</view>
          </view>
        </view>
      </view>
    </view>

    <view class="summary" wx:if="{{aiSummary}}">
      <view class="summary__title">AI 总结</view>
      <view class="summary__text">{{aiSummary}}</view>
    </view>

    <view class="tail" />
  </scroll-view>

  <view class="footer safe-bottom">
    <button class="btn" bindtap="onDone">{{doneText}}</button>
    <button wx:if="{{canGenerateAiSummary}}" class="btn-ghost" loading="{{aiLoading}}" bindtap="onGenerateAiSummary">
      生成 AI 总结
    </button>
  </view>
</view>
