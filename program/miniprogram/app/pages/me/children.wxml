<view class="page">
  <ui-header
    title="{{formMode === 'add' ? 'æ·»åŠ å­©å­' : formMode === 'edit' ? 'ç¼–è¾‘å­©å­' : 'å­©å­ç®¡ç†'}}"
    left="back"
    bind:left="onHeaderLeft"
  />

  <scroll-view wx:if="{{!formMode}}" class="body safe-bottom" scroll-y="true" enhanced="true" show-scrollbar="false">
    <view class="wrap">
      <view wx:for="{{children}}" wx:key="id" class="row-card row between">
        <view class="row">
          <view class="face {{item.gender == 1 ? 'boy' : item.gender == 2 ? 'girl' : 'unk'}}">
            <text>{{item.gender == 1 ? 'ğŸ‘¦' : item.gender == 2 ? 'ğŸ‘§' : 'ğŸ™‚'}}</text>
          </view>
          <view class="col meta">
            <view class="name">{{item.nickname}}</view>
            <view class="sub">{{item.age}}å² Â· {{item.birthDate}} Â· {{item.parentIdentity}}</view>
          </view>
        </view>
        <view class="right">
          <view
            class="btn-link"
            bindtap="onEdit"
            data-id="{{item.id}}"
            data-nickname="{{item.nickname}}"
            data-gender="{{item.gender}}"
            data-birth-date="{{item.birthDate}}"
            data-parent-identity="{{item.parentIdentity}}"
          >
            ç¼–è¾‘
          </view>
        </view>
      </view>

      <button class="add" bindtap="onAdd">
        <text class="add__icon">ï¼‹</text>
        æ·»åŠ å­©å­
      </button>
    </view>
  </scroll-view>

  <view wx:else class="form-page">
    <scroll-view class="form-body" scroll-y="true" enhanced="true" show-scrollbar="false">
      <view class="form-wrap">
        <view class="gender-pick row center">
          <view class="gender-option col center {{gender == 1 ? 'on' : 'off'}}" bindtap="setBoy">
            <view class="gender-circle boy {{gender == 1 ? 'on' : ''}}">
              <text class="gender-emoji">ğŸ‘¦</text>
            </view>
            <view class="gender-label boy {{gender == 1 ? 'on' : ''}}">ç”·å­©</view>
          </view>
          <view class="gender-option col center {{gender == 2 ? 'on' : 'off'}}" bindtap="setGirl">
            <view class="gender-circle girl {{gender == 2 ? 'on' : ''}}">
              <text class="gender-emoji">ğŸ‘§</text>
            </view>
            <view class="gender-label girl {{gender == 2 ? 'on' : ''}}">å¥³å­©</view>
          </view>
        </view>

        <view class="field">
          <view class="label">å­©å­æ˜µç§°</view>
          <view class="input-wrap">
            <input class="input" placeholder="è¯·è¾“å…¥å­©å­çš„å°å" value="{{nickname}}" bindinput="onNickname" focus="{{true}}" />
          </view>
        </view>

        <view class="field">
          <view class="label">å‡ºç”Ÿæ—¥æœŸ</view>
          <picker mode="date" value="{{birthDate}}" start="1900-01-01" end="{{today}}" bindchange="onBirthDate">
            <view class="input-wrap row between a">
              <view class="date-text {{birthDate ? '' : 'muted'}}">{{birthDate || 'å¹´ / æœˆ / æ—¥'}}</view>
              <view class="input-icon">ğŸ“…</view>
            </view>
          </picker>
        </view>

        <view class="field">
          <view class="label">æˆ‘æ˜¯å­©å­çš„â€¦</view>
          <view class="relation-grid">
            <view
              wx:for="{{parentIdentityOptions}}"
              wx:key="*this"
              class="relation {{parentIdentity == item ? 'on' : ''}}"
              bindtap="onPickParentIdentity"
              data-value="{{item}}"
            >
              {{item}}
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="form-footer safe-bottom">
      <button class="save-info" loading="{{saving}}" bindtap="onSave">ä¿å­˜ä¿¡æ¯</button>
    </view>
  </view>
  <auth-modal show="{{showAuthModal}}" bind:success="onAuthSuccess" bind:close="onAuthClose" />
</view>
